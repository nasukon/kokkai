<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衆議院 会派別議席数シミュレーター</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- D3.js v7 CDN -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* Interフォントの読み込み */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* チェックボックスのカスタムスタイル */
        .party-checkbox:checked {
            background-color: currentColor;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
        /* D3のツールチップ用（非表示） */
        .d3-tooltip {
            position: absolute;
            visibility: hidden;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.875rem;
            pointer-events: none;
            transition: opacity 0.2s;
            opacity: 0;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="w-full max-w-6xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
        <h1 class="text-2xl md:text-3xl font-bold text-center mb-6 text-white">
            衆議院 会派別議席数シミュレーター (総議席数: 465)
        </h1>

        <div class="flex flex-col md:flex-row gap-6 md:gap-8">

            <!-- 左側: グラフコンテナ -->
            <div class="md:w-1/2 flex flex-col items-center justify-center bg-gray-900 p-4 rounded-lg shadow-inner min-h-[300px] md:min-h-[450px]">
                <div id="chart-container"></div>
                <div class="d3-tooltip"></div>
            </div>

            <!-- 右側: シミュレーションコントロール -->
            <div class="md:w-1/2">
                <!-- シミュレーション結果表示 -->
                <div id="simulation-result" class="bg-gray-700 rounded-lg p-6 mb-6 shadow-md transition-all duration-300">
                    <h2 class="text-lg font-semibold mb-3 text-gray-300">選択した会派の合計議席数</h2>
                    <div id="total-seats-display" class="text-5xl font-bold text-yellow-400">0 議席</div>
                    <div id="majority-status" class="text-xl font-semibold mt-2 text-yellow-400">過半数 (233議席) 未達</div>
                </div>

                <!-- 会派選択チェックボックス -->
                <div class="bg-gray-700 rounded-lg p-6 shadow-md">
                    <h2 class="text-lg font-semibold mb-4 text-gray-300 border-b border-gray-600 pb-2">会派を選択</h2>
                    <div id="controls-container" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                        <!-- チェックボックスはJSで動的に生成されます -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. データ定義 (CSVファイルに基づく) ---
        // CSV `会派別所属議員数 - 衆議院.csv` から "合計", "欠員", 議席数"-" の行を除外したデータ
        const partyData = [
            { name: '自由民主党・無所属の会', seats: 196, color: '#3182CE' }, // Blue
            { name: '立憲民主党・無所属 (※)', seats: 148, color: '#48BB78' }, // Green
            { name: '日本維新の会 (※)', seats: 35, color: '#F56565' }, // Red
            { name: '公明党', seats: 24, color: '#ECC94B' }, // Yellow
            { name: '国民民主党・無所属クラブ (※)', seats: 27, color: '#ED8936' }, // Orange
            { name: '日本共産党', seats: 8, color: '#9F7AEA' }, // Purple
            { name: 'れいわ新選組', seats: 9, color: '#F687B3' }, // Pink
            { name: '有志の会', seats: 4, color: '#4FD1C5' }, // Teal
            { name: '参政党', seats: 3, color: '#A0AEC0' }, // Gray-500
            { name: '改革の会', seats: 3, color: '#718096' }, // Gray-600
            { name: '減税保守こども', seats: 3, color: '#CBD5E0' }, // Gray-300
            { name: '無所属 (※)', seats: 5, color: '#E2E8F0' }  // Gray-200
        ];

        const TOTAL_SEATS = 465;
        const MAJORITY_LINE_SEATS = 233;

        // --- 2. D3.js グラフ設定 ---
        const width = 400;
        const height = 400;
        const margin = 20;
        const radius = Math.min(width, height) / 2 - margin;

        const svg = d3.select("#chart-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${width / 2}, ${height / 2})`);

        // ツールチップの選択
        const tooltip = d3.select(".d3-tooltip");

        // パイレイアウト
        const pie = d3.pie()
            .value(d => d.seats)
            .sort(null); // データ配列の順序を維持

        // アーク（円弧）ジェネレータ
        const arc = d3.arc()
            .innerRadius(radius * 0.5) // ドーナツグラフにする
            .outerRadius(radius * 0.9);
        
        // ホバー時用のアーク
        const arcHover = d3.arc()
            .innerRadius(radius * 0.5)
            .outerRadius(radius);

        // --- 3. グラフ描画 ---
        const arcs = svg.selectAll("path")
            .data(pie(partyData))
            .enter()
            .append("path")
            .attr("class", "party-slice") // シミュレーションで選択するためのクラス
            .attr("d", arc)
            .attr("fill", d => d.data.color)
            .attr("stroke", "#1a202c") // bg-gray-900
            .style("stroke-width", "2px")
            .style("opacity", 0.3) // 初期状態ではすべて非選択（薄く表示）
            .style("transition", "opacity 0.3s, transform 0.2s")
            // ツールチップイベント
            .on("mouseover", function(event, d) {
                d3.select(this)
                    .transition().duration(200)
                    .attr("d", arcHover);
                tooltip
                    .style("visibility", "visible")
                    .style("opacity", 1)
                    .html(`<strong>${d.data.name}</strong><br>${d.data.seats} 議席`);
            })
            .on("mousemove", function(event) {
                tooltip
                    .style("top", (event.pageY - 10) + "px")
                    .style("left", (event.pageX + 10) + "px");
            })
            .on("mouseout", function() {
                d3.select(this)
                    .transition().duration(200)
                    .attr("d", arc);
                tooltip
                    .style("visibility", "hidden")
                    .style("opacity", 0);
            });

        // --- 4. 過半数ラインの描画 ---
        const majorityAngle = (MAJORITY_LINE_SEATS / TOTAL_SEATS) * 2 * Math.PI - (Math.PI / 2);

        svg.append("line")
            .attr("x1", 0)
            .attr("y1", 0)
            .attr("x2", Math.cos(majorityAngle) * radius * 1.05)
            .attr("y2", Math.sin(majorityAngle) * radius * 1.05)
            .attr("stroke", "#F56565") // Red-500
            .attr("stroke-width", 2)
            .attr("stroke-dasharray", "5,5");

        svg.append("text")
            .attr("x", Math.cos(majorityAngle) * radius * 1.1)
            .attr("y", Math.sin(majorityAngle) * radius * 1.1)
            .attr("text-anchor", "middle")
            .attr("alignment-baseline", "middle")
            .attr("fill", "#F56565")
            .style("font-size", "12px")
            .style("font-weight", "600")
            .text("過半数 (233)");

        // --- 5. シミュレーションUI (コントロール) の生成 ---
        const controlsContainer = document.getElementById("controls-container");
        const resultDisplay = document.getElementById("total-seats-display");
        const statusDisplay = document.getElementById("majority-status");
        const resultCard = document.getElementById("simulation-result");

        partyData.forEach((party, index) => {
            const label = document.createElement("label");
            label.className = "flex items-center p-3 bg-gray-800 rounded-md hover:bg-gray-600 transition duration-200 cursor-pointer";
            label.style.color = party.color; // ラベルテキストに色を適用

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "party-checkbox h-5 w-5 rounded border-gray-500 text-gray-500 focus:ring-0 focus:ring-offset-0";
            checkbox.dataset.index = index; // D3のデータインデックスと同期
            checkbox.style.color = party.color; // チェックボックスの色

            const text = document.createElement("span");
            text.className = "ml-3 font-semibold";
            text.textContent = `${party.name} (${party.seats}議席)`;

            label.appendChild(checkbox);
            label.appendChild(text);
            controlsContainer.appendChild(label);

            // イベントリスナーを追加
            checkbox.addEventListener("change", updateSimulation);
        });

        // --- 6. シミュレーション更新ロジック ---
        function updateSimulation() {
            let totalSelectedSeats = 0;
            const selectedIndices = new Set();

            // チェックボックスの状態を読み取り、合計議席を計算
            document.querySelectorAll(".party-checkbox:checked").forEach(cb => {
                const index = parseInt(cb.dataset.index, 10);
                selectedIndices.add(index);
                totalSelectedSeats += partyData[index].seats;
            });

            // グラフの不透明度を更新
            svg.selectAll(".party-slice")
                .style("opacity", (d, i) => selectedIndices.has(i) ? 1.0 : 0.2);

            // 結果表示を更新
            resultDisplay.textContent = `${totalSelectedSeats} 議席`;

            if (totalSelectedSeats >= MAJORITY_LINE_SEATS) {
                statusDisplay.textContent = `過半数 (233議席) 達成`;
                resultDisplay.className = "text-5xl font-bold text-green-400";
                statusDisplay.className = "text-xl font-semibold mt-2 text-green-400";
                resultCard.classList.remove("border-yellow-400");
                resultCard.classList.add("border-green-400");
            } else {
                statusDisplay.textContent = `過半数 (233議席) 未達`;
                resultDisplay.className = "text-5xl font-bold text-yellow-400";
                statusDisplay.className = "text-xl font-semibold mt-2 text-yellow-400";
                resultCard.classList.remove("border-green-400");
                resultCard.classList.add("border-yellow-400");
            }
        }
        
        // 初期状態を更新（0議席）
        updateSimulation();

    </script>
</body>
</html>
